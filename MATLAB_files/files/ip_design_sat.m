clear
format compact

h = 0.005;       % サンプリング周期

Tf1 = 0.08;      % ローパスフィルタの時定数
Tf2 = 0.08;      % ローパスフィルタの時定数

% =============================================
theta2stb =  25  % deg
omega2stb = 300  % deg/s
theta2sw  = 120  % deg

ksw   = 6.5      % 振り上げゲイン
v_sat = 3.5      % 振り上げ制御時の制御入力の上限値

% =============================================
g  = 9.81e+00;
L1 = 9.20e-02;  % 9.2cm

a1 = 1.25e+01;
b1 = 3.42e+01;

a2 = 1.59e-01;
b2 = 2.41e-02;

E = [ 1  0  0  0
      0  1  0  0
      0  0  1  0
      0  L1 0  a2 ];
F = [ 0  1  0  0
      0 -a1 0  0
      0  0  0  1
      0  0  g -b2 ];
G = [ 0
      b1
      0
      0 ];

A = inv(E)*F
B = inv(E)*G

disp('++++++++++++++++++++++++++++++++++++++++++++++++')
disp(' 重み行列 Q, R')
disp('++++++++++++++++++++++++++++++++++++++++++++++++')

q1 = 0.2;
q3 = 100;

Q = diag([q1 0 q3 0])
R = 1

disp('++++++++++++++++++++++++++++++++++++++++++++++++')
disp(' 最適レギュレータによるコントローラゲイン K')
disp('++++++++++++++++++++++++++++++++++++++++++++++++')

K = -lqr(A,B,Q,R)

disp('++++++++++++++++++++++++++++++++++++++++++++++++')
disp(' A + B*K の固有値')
disp('++++++++++++++++++++++++++++++++++++++++++++++++')

eig(A + B*K)
